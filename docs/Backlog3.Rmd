---
title: "Using novel remote electronic monitoring to measure and manage the Rheumatology Clinic backlog generated by COVID-19"
author: "D Kurzeja"
bibliography: references.bib 
csl: nature.csl
link-citations: true 
output:
  html_document: 
    toc: true
    toc_float: true
    toc_collapsed: true
    toc_depth: 3
    number_sections: false
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(lubridate)
library(knitr)
library(rstatix)
library(gtsummary)
library(labelled)
library(gridExtra)
library(patchwork)
library(kableExtra)
library(zoo)
library(ggpubr)
library(ggsci)
library(RColorBrewer)
library(cowplot)
library(rlang)
library(data.table)
library(formattable)
library(janitor)
library(extrafont)
library(kSamples)
```

## Background and Aims

As a result of the COVID-19 pandemic we have accumulated a significant backlog of patients with inflammatory conditions and chronic rheumatic diseases, many of whom are established on immune therapies, and who need regular review to ensure their safety and determine the efficacy of their treatment.

During this period our centre reserved our outpatient clinic appointments for patients needing urgent review but this has meant a substantial delay in regular review for patients who were not currently indicating any urgent problems.

The aim of the project is to understand the nature of the backlog in terms of the types of diagnosis and treatment, as well as documenting how we are attempting to deal with the backlog through a variety of types of consultation.

When is is not possible to book patients into a clinic appointment either for a face-to-face, telephone or video consultation, they remain on the backlog. However, once they have had an evaluation either by remote consultation or by direct consultation (face-to-face, telephone or video) the date on which they are recorded as being on the backlog (or "status date") is updated to reflect that date within our electronic systems.

Therefore, to demonstrate our clinical impact on the backlog we cannot show a reduction in the total numbers of patients who are awaiting outpatient follow up, but we are able to demonstrate change in the numbers of patients waiting on the backlog for longer than a certain period.

**The total backlog of patients in September 2021 without allocated follow up was approximately 6812.**

We have used three main types of clinical encounter to allow us to assess patients who are currently on the backlog:

1.  Face-to-face clinic appointments
2.  Virtual consultation either by telephone or video
3.  Remote consultation - by electronic remote management form (RMF) (see *Methods*)

As part of the aims of this project

[**This project has two main aims:**]{.underline}

1.  **Primary:** To collect data on the number of patients per calendar month who are on the backlog, and measure how this number changes over time -- with a view to assessing how well the department is clearing this backlog

2.  **Secondary:** To understand the nature of the consultations that have contributed to dealing with patients on the backlog, using data from remote management databases and clinic appointment outcome forms -- including types of consultations, diagnoses and follow up/management outcomes, where possible


## Methods {.tabset .tabset-fade .tabset-pills}

### Sample Selection

In September 2021 (start date of this project), we identified after discussion that the 12-month period May 2020 - May 2021 was the period during which there was the most disruption to normal outpatient services in the department.

We analysed the number of patients who were had a status date between May 2020 and May 2021, inclusive, from the hospital's 'Revenue Cycle' system; i.e. patients who were awaiting follow up since dates during during this period.

This was 3259 patients out of the total backlog of 6812.

### Audit Methodology

We revisited the number of patients remaining from that cohort (without a change in status date) on four occasions between September2021 and September 2022: at baseline, then at 1-, 2-, 6-and 12-month intervals (Fig. 1)

![Figure 1. Audit Methodology](/Users/dominikkurzeja/Docs/07. Medicine/Clinical Work/IMT OUH/Rheum QIPs/Backlog QIP/docs/images/schema3 landscape.png)

### Consultation Data & Remote Management Forms

As outlined above, additional data was collected on what consultation types patients waiting on the backlog received.

In addition to face to face, video or telephone, we used RMFs specific to different disease groups, which were designed by the department.

Some patients were sent a link to an electronic form (in lieu of face-to-face or virtual consultation) which they complete giving us details of their current state, which we import into our database. They contained a triage questionnaire, including calculation of disease severity scores, and questions about current medications. There were presented for review by a clinician who can decide on how best to manage the patient.

The remote clinical management project is a separate project but data from it are included in this project [@malley2021].

### Data storage and analysis

Data from RMFs was stored in a secure database for clinician review

Data analysis performed in Microsoft Excel and R (version 4.2.1).

## Results

```{r data_import, echo = FALSE, warning = FALSE, include=FALSE}

# DATA IMPORT ----
# backlog audit data up to Sep 22 (Cycle 5)
september_22_backlog_audit <- read_csv("/Users/dominikkurzeja/Docs/07. Medicine/Clinical Work/IMT OUH/Rheum QIPs/Backlog QIP/data/september 22 backlog audit.csv")
sepaud <- september_22_backlog_audit 

# forms
forms <- read_csv("/Users/dominikkurzeja/Docs/07. Medicine/Clinical Work/IMT OUH/Rheum QIPs/Backlog QIP/data/forms_backlog.csv")

# wrangling 
# pivot longer to make a stats table
sepaud_stats <- sepaud %>% pivot_longer(cols = 'C1':'C5',
                         names_to = "cycle",
                         names_prefix = "C", 
                         values_to = "patients")  %>%  select(patients, cycle)


```

The table below shows how the number of patients on the backlog with a status date during our period of interest declined over time between audits, with a fall in both the total number of patients and the patients waiting in each month seen at each cycle.

```{r table_results, echo = FALSE, warning=FALSE, paged.print=FALSE}

# Kable table for the audit
table1 <- sepaud %>% rename("Date of last encounter" = "yearmon")
kable(table1, caption = "Table 1", "simple")
```


Figure 2 is a graphical representation of this reduction:

```{r col_graph, echo=FALSE, warning=FALSE, fig.cap= "Figure 2"}

# making the yearmon a true "year mon" class
sepaud2 <-  sepaud
sepaud2$yearmon <-  sepaud2$yearmon %>% as.yearmon("%b-%y")

# longer format to permit graph
sepaud2 <- sepaud2 %>% pivot_longer(cols = c(C1:C5), names_to = "cycle", values_to = "patients")

# factorizing the cylce date to allow heirarchy
sepaud2$yearmon <- sepaud2$yearmon %>% as.character() %>% as_factor()

# taking the names to use in the plot as labels
nms <- c("C1 (baseline)","C2 (+1mo)","C3 (+2mo)","C4 (+6mo)","C5 (+12mo)")

sepaud2$cycle <- sepaud2$cycle %>% str_replace_all(c("C1" = "C1 (baseline)","C2" = "C2 (+1mo)","C3"= "C3 (+2mo)","C4" = "C4 (+6mo)", "C5" = "C5 (+12mo)"))

#### FIGURE 2 ----
# creating a column plot
sep_plot <- ggplot(data = sepaud2, aes(x = yearmon, y = patients)) + geom_col(aes(fill = cycle),  position = "dodge") 
sep_plot <- sep_plot + theme_minimal() + scale_fill_npg(alpha = .8) + ylim(0,600)
sep_plot <- sep_plot + theme(axis.text.x = element_text(angle = 60, hjust = 1, vjust = 1))  
sep_plot <- sep_plot + labs(y = "Patients", x = "Month", fill = "Audit Cycle")


sep_plot

```

### Analyzing the Backlog 

#### Key Points {.tabset .tabset-fade .tabset-pills}

We demonstrate a 90% reduction (3259 -> 326) in the total number of patients waiting for follow up on the backlog over a one year period of observation. 

There was a statistically significant reduction in the total number of patients on the backlog with a statistically significant decrease between each of the four audit cycles. 71% of this reduction was achieved in 6 months (by March 2022). 

This reduction was statistically significant and linearly progressive between audit cycles.

There was no statistically significant change in the number and distribution of patients across the 12 month period between audit cycles, implying the "shape" of the backlog remains the same. 

(p\<0.001 -Chi-square test for trend).
(Chi-square test, p-value = 5.89e-274 ), 

See the tabs below for more detailed analysis.

##### Size 

To compare the *total* number of patients on the backlog at the time of each of the three cycles, a  ("C1", "C2" and "C3").

```{r chisquare , echo=FALSE, warning=FALSE}
#calculate the totals for each cycle
chistotals <- sepaud %>% select(C1:C5)  %>% summarise(C1 = sum(C1), C2 = sum(C2), C3 = sum(C3), C4 = sum(C4), C5 = sum(C5))

kable(chistotals, "simple", caption = "Table 2 - Sum of patients on backlog at the time of each audit cycle")
```

This can be performed with a **Chi-squared** test:

Unpaired test:

```{r unpairedchi, echo=FALSE, warning=FALSE}

#unpaired test
chires_totals <- chisq_test(chistotals, rescale.p = TRUE)
kable(chires_totals, "simple")

kable(chisq_descriptives(chires_totals), "simple")
```

Pairwise comparison:

```{r pairwisechi, echo=FALSE, warning=FALSE}
#pairwise test
# chipaires <- pairwise_chisq_gof_test(chistotal, s)
# kable(chipaires)
```

Therefore there is a statistically significant difference between the number of the patients on the backlog during this period at each of the three time points.


##### Distribution

An **Anderson-Darling k-sample test** (for multiple groups of non-parametric data) can be preformed on the data, comparing the distributions of the patients in each cycle of the audit (C1-5):


```{r anderson-douglas, echo =FALSE, warning=FALSE}
ad.test(sepaud_stats$patients ~ sepaud_stats$cycle, method = "exact", dist = FALSE, Nsim = 1000)
```

This shows that there is no statistically significant difference between the distribution of the number of patients backlog for the months in the May 20 - May 21 period. 

We can infer from this that the *shape* of the backlog does not change - i.e. there are always more people on it more recently than at the dates furthest back in time.

##### Trend

Additionally we can calculate the **Cochran-Armitage test** (a Chi-squared test for linear trends in changing proportions) with the assumption of the same proportion of patients in each month in each cycle:

First construct a table:

```{r cochran table, echo = FALSE}

#creating a better summary table using unite to create a 'monyear' column
#  datsummary <- chistats %>% unite(monyear, mon, year, sep = " ", remove = TRUE) %>% mutate(audit_month = row_number()) %>% select(!month)
#  
#  datsummary <- set_variable_labels(datsummary, monyear = "Month")
#  
# trendaudit <- rbind(c(datsummary$C1), c(datsummary$C2), c(datsummary$C3), c(datsummary$C4))
# 
# dimnames(trendaudit) <- list(
#   cycle = c("C1", "C2", "C3", "C4"),
#   month = c(datsummary$monyear))
# 
# trendaudit <- t(trendaudit)
# kable(trendaudit)
```

Then we perform the test:

```{r cochran test, echo=FALSE}
# 
# trendres <- trendaudit %>% prop_trend_test( score = c(1:13))
# kable(trendres)
```

This shows a highly statistically significant possible linear association between cycle and patients in each month


### Remote Management Forms

1956 RMFs were completed between Sep-21 -Mar-22
(no data available since then)
•
Only 261 patients recorded a previous appointmentdate.
•
154/261 (59%) were completed by patients in the"window" of May-20 -May-21, indicating a preferentialuse of RMFs targeting backlog patients.
•
Between 2-8% of the total backlog patients weremanaged using RMFs based on available data (Table.
1.).

Remote management forms collected data from patients who were on the backlog. They took the form of triage questionairres and including the relevant questions to calculate disease severity scores; as well as asking about medications, side effects and other disease factors.

There were seperate remote managemnt forms created for each of the following diagnostic groups:

-   Ankylosing Spondylitis/BASDAI scoring

-   SLE

-   Rheumatoid Arthritis

-   Vasculitis

-   Psoriatic Arthritis

The data collected from these forms is summarised below, with a particular focus on how patients from the backlog were dealt with.

```{# {r remote management data, include = FALSE, echo = FALSE, warning = FALSE}
# 
# #data import
# rmd <- read_csv("data/remote_management_data.csv")
# rmd$visit <- parse_date(rmd$visit,  "%d/%m/%Y")
# rmd$prev_appt <- parse_date(rmd$prev_appt, "%d/%m/%Y")
# 
# #making the vasculitis type key
# vasctype <- tibble(code = c(1,2,3,4), type = c("small", "medium", "large", "other"))
# #making the clinic types

```

The total number of forms is:

```{r backlog tables, echo = FALSE, warning = FALSE}
# ###number of forms per clinic type ====
# byclinic <- rmd %>% group_by(clinic) %>% summarise(count = n())
# #Preliminary exploration ====
# ##number of remote management forms: ====
# kable(count(rmd)) #1306
```

The number of forms which are "incomplete" with respct to our analysis is the number for which the patient's previous appointment date is not known. This number is:

```{r echo = FALSE}
##incomplete data: ====
# no_prev_appt <- rmd %>% filter(is.na(prev_appt)) %>% count() #746
# kable(no_prev_appt)

```

This represents more than half the data

### Diagnoses and Management {.tabset}

#### Per Diagnosis

The number of forms reviewed per diagnostic group - total

```{r echo = FALSE, warning = FALSE}
# tab3 <- byclinic %>% 
#   transmute("Diagnosis" = clinic, "Patients reviewed (total)" = count) %>% 
#   kbl() %>% kable_styling()
# tab3

```

#### Time on Backlog

```{r quarterly data, echo = FALSE, warning = FALSE}
# dates <- rmd %>% filter(!is.na(prev_appt))
# 
# #dividing up into quarters starting in Nov 2020 when the data starts
# dates <- dates %>% mutate(visit_month = floor_date(visit, "month"))
# dates <- dates %>% mutate(quarter = quarter(visit_month, type = "year.quarter", fiscal_start = 11))
# 
# #adding a months interval of time on backlog
# dates$interval <- interval(dates$prev_appt, dates$visit) %/% months(1)
# 
# #number seen per quarter:
# byquarter <- dates %>% group_by(quarter)
# 
# #remove incorrect data for which there war an apparent negative date interval in months (n = 7)
# dates <- dates %>% filter(interval >= 0)
# 
# #displaying numbers seen and waits per quarted
# quarter_fu <- dates %>% group_by(quarter) %>% summarise(reviewed = n(), min_wait = min(interval), max_wait = max(interval), median_wait = median(interval))
# 
# #numbers seen and waits per clinic
# clinic_fu <- dates %>% group_by(clinic) %>% summarise(reviewed = n(), min_wait = min(interval), max_wait = max(interval), median_wait = median(interval))
# 
# #grouping how many have waited for how long
# fu3 <- dates %>%subset(interval<3) %>% summarise("<3 months" = n())
# fu6 <- dates %>% subset(interval>=3 & interval <6) %>% summarise("3-6 months" = n())
# fu12 <- dates %>% subset(interval>=6) %>% summarise(">6 months" = n())
#   #554 in total with a follow up interval
# 
# 
# fu_duration <- tibble("Time on Backlog" = c("<3 months", "3-6 months", ">6 months"), "Patients" = as.double(c(fu3,fu6,fu12)))
# 
# tab2 <- fu_duration  #follow up duration number of patients
# tab2 <- tab2 %>%  kbl() %>% kable_styling()
# tab2

```

#### Quarterly Data

We were able to further analyse how patients were being cleared from the backlog by the remote management forms by analysing data in quarters (i.e. grouping patients by the three month window in which their remote management data was reviewed)

```{r echo = FALSE}
# tab1 <- quarter_fu %>% select(!min_wait) %>% 
#   transmute("3 month quarter (from Nov 20)" = quarter, 
#             "No. patients reviewed" = reviewed,
#             "Max time on backlog (months)" = max_wait,
#             "Median time on backlog (months)" = median_wait)
# tab1 %>% kbl() %>% kable_styling() %>%row_spec(0, align = "c")


```

####  {.unnumbered}


## Conclusions + Discussion


Our outpatient backlog has been significantly reduced over a12-month period. 

Remote management made a sizeable contribution to this 
reduction, meaning some of this reduction was achievedwithout face-to-face encounters; these results underestimatethe effect of RMFs due to this dataset being incomplete 

1956 RMFs completed in a 6-month period shows robustintegration of our RMFs into outpatient services disrupted by 
COVID-19 and provides evidence for remote managementas a useful tool in outpatient management, with relevance toareas such as Patient Initiatedfollow-up pathways. 

Further work is needed to clarify where remote managementis best deployed and which patient groups benefit most fromthis. 


## References